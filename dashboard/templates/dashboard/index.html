{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
<link rel="stylesheet" href="{% static 'dashboard/style.css' %}">
<title>Bảng điều khiển | MoreLen</title>
<style>
    main section.custom-section { display: none; margin-bottom: 30px; }
    main section.custom-section.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { text-align: left; padding: 10px; border-bottom: 1px solid #ddd; }
    th { background-color: #f0f0f0; }
    img.avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    body.dark-mode-variables { background-color: #181a1e; color: #f1f1f1; }
    body.dark-mode-variables table { background-color: #1e1f24; color: #eaeaea; border-color: #444; }
    body.dark-mode-variables th { background-color: #2c2e35 !important; color: #fff !important; border-bottom: 1px solid #444; }
    body.dark-mode-variables td { color: #e5e5e5 !important; border-bottom: 1px solid #333; }
    body.dark-mode-variables h1,h2,h3,p,a { color: #f0f0f0 !important; }
    body.dark-mode-variables a:hover { color: #00b4d8 !important; }
    body.dark-mode-variables aside { background-color: #1a1b20 !important; }
    #dashboard-section {
        padding: 20px;
        font-family: "Times New Roman", Times, serif;
    }

    #dashboard-section h1 {
        text-align: center;
        margin-bottom: 30px;
    }

    .analyse {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 40px;
    }

    .card {
        background-color: #9ae7eeff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        padding: 30px 40px;
        text-align: center;
        min-width: 180px;
        flex: 1 1 200px;
        transition: transform 0.2s;
    }

    .card:hover {
        transform: translateY(-5px);
    }

    .card h3 {
        font-size: 16px;
        color: #555;
        margin-bottom: 10px;
    }

    .card h1 {
        font-size: 28px;
        color: #111;
    }

    .new-users h2 {
        margin-bottom: 20px;
        text-align: center;
    }

    .user-list {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .user {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        padding: 15px;
        text-align: center;
        width: 150px;
        font-family: "Times New Roman", Times, serif;

    }

    .user img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 10px;
    }

    .user h2 {
        font-size: 16px;
        margin-bottom: 5px;
    }

    .user p {
        font-size: 12px;
        color: #777;
    }



</style>
</head>
<body>

<div class="container">

    <aside>
        <div class="toggle">
            <div class="logo">
                <img src="{% static 'dashboard/images/More len.png' %}" style="width:50px; height:50px; object-fit:contain;">
                <h2>More<span class="danger">Len</span></h2>
            </div>
            <div class="close" id="close-btn"><span class="material-icons-sharp">close</span></div>
        </div>
        <div class="sidebar">
            <a href="#" class="active" data-target="dashboard-section"><span class="material-icons-sharp">dashboard</span><h3>Bảng điều khiển</h3></a>
            <a href="#" data-target="users-section"><span class="material-icons-sharp">person_outline</span><h3>Tài khoản</h3></a>
            <a href="#" data-target="products-section"><span class="material-icons-sharp">inventory</span><h3>Sản phẩm</h3></a>
            <a href="#" data-target="categories-section"><span class="material-icons-sharp">category</span><h3>Danh mục</h3></a>
            <a href="#" data-target="orders-section"><span class="material-icons-sharp">receipt_long</span><h3>Đơn hàng</h3></a>
            <a href="#" data-target="payments-section"><span class="material-icons-sharp">payment</span><h3>Thanh toán</h3></a>
            <a href="#" data-target="revenues-section"><span class="material-icons-sharp">analytics</span><h3>Doanh thu</h3></a>

            <a href="http://localhost:5173/login"><span class="material-icons-sharp">logout</span><h3>Đăng xuất</h3></a>
        </div>
    </aside>

    <main>

    <div id="dashboard-section">
        <h1>Thống kê</h1>
        <div class="analyse">
            <div class="card sales">
                <div class="info">
                    <h3>Tổng doanh thu</h3>
                    <h1>{{ total_sales|intcomma }} VND</h1>
                </div>
            </div>

            <div class="card orders">
                <div class="info">
                    <h3>Đơn hàng</h3>
                    <h1>{{ total_orders }}</h1>
                </div>
            </div>

            <div class="card products">
                <div class="info">
                    <h3>Tổng sản phẩm</h3>
                    <h1>{{ total_products }}</h1> 
                </div>
            </div>
        </div>

        <div class="new-users">
            <h2>Người dùng mới</h2>
            <div class="user-list">
                {% for user in new_users %}
                <div class="user">
                    {% if user.avatar %}
                    <img src="{{ user.avatar.url }}" alt="{{ user.username }}">
                    {% else %}
                    <img src="{% static 'dashboard/images/profile-1.jpg' %}" alt="default avatar">
                    {% endif %}
                    <h3>{{ user.username }}</h3>
                    <p>{{ user.date_joined|timesince }} ago</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>


        <section id="users-section" class="custom-section">
            <h2>Tài khoản</h2>

            <table>
                <thead>
                    <tr><th>Ảnh đại diện</th><th>Tên người dùng</th><th>Email</th><th>Tên</th><th>Họ</th><th>SĐT</th><th>Ngày tạo</th><th></th></tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{% if user.avatar %}<img src="{{ user.avatar.url }}" class="avatar">{% else %}<img src="{% static 'dashboard/images/profile-1.jpg' %}" class="avatar">{% endif %}</td>
                        <td>{{ user.username }}</td><td>{{ user.email }}</td><td>{{user.last_name}}</td><td>{{user.first_name}}</td><td>{{ user.phone|default:"-" }}</td>
                        <td style="white-space: nowrap;">{{ user.date_joined|date:"Y-m-d H:i" }}</td>
                        <td style="vertical-align: middle; text-align: center; white-space: nowrap;">
                            <a href="{% url 'user_update' user.id %}" class="btn-edit">Sửa</a> 
                            <a href="{% url 'user_delete' user.id %}" class="btn-delete">Xóa</a>
                        </td>   
                    </tr>
                    {% empty %}
                    <tr><td colspan="8">Không tìm thấy người dùng nào</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section id="products-section" class="custom-section">
            <h2>Sản phẩm</h2>
        <a href="{% url 'product_create' %}" 
        style="float:right; background:#2196F3; color:white; 
                padding:8px 14px; border-radius:6px; text-decoration:none; 
                margin-bottom:10px; display:inline-block;">
        Thêm sản phẩm
        </a>
            <table>
                <thead><tr><th>Ảnh</th><th>Tên</th><th>Danh mục</th><th>Giá</th><th>Tồn kho</th><th>Đã bán</th><th>Trạng thái</th><th></th></tr></thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>{% if product.image %}<img src="{{ product.image.url }}" class="avatar">{% else %}<img src="{% static 'dashboard/images/profile-1.jpg' %}" class="avatar">{% endif %}</td>
                        <td>{{ product.name }}</td><td>{% if product.category %}{{ product.category.name }}{% else %}-{% endif %}</td>
                        <td>{{ product.price }}</td><td>{{ product.stock }}</td><td>{{ product.sold }}</td><td>{{ product.get_status_display }}</td>

                        <td><a href="{% url 'product_update' product.id %}" class="btn-edit">Sửa</a> 
                            <a href="{% url 'product_delete' product.id %}" class="btn-delete">Xóa</a></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7">Không tìm thấy sản phẩm nào</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section id="categories-section" class="custom-section">
            <h2>Danh mục</h2>
            <a href="{% url 'category_create' %}" 
            style="float:right; background:#2196F3; color:white; 
                    padding:8px 14px; border-radius:6px; text-decoration:none; 
                    margin-bottom:10px; display:inline-block;">
            Thêm danh mục
            </a>
            <table>
                <thead><tr><th>Tên</th><th>Danh mục cha</th><th></th></tr></thead>
                <tbody>
                    {% for category in categories %}
                    <tr>
                        <td>{{ category.name }}</td>
                        <td>{% if category.parent %}{{ category.parent.name }}{% else %}-{% endif %}</td>
                        <td><a href="{% url 'category_update' category.id %}" class="btn-edit">Sửa</a> <a href="{% url 'category_delete' category.id %}" class="btn-delete">Xóa</a></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3">Không tim thấy danh mục nào</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section id="orders-section" class="custom-section">
        <h2 style="font-family:'Poppins',sans-serif; font-weight:600; margin-bottom:15px;">Danh sách đơn hàng</h2>

    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-family: "Poppins", sans-serif;
            font-size: 14px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        th {
            background-color: #f6f7fb;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            text-align: left;
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        img.avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .btn-edit, .btn-delete, .btn-add, .btn-detail {
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-add { background-color:#2196F3; color:#fff; }
        .btn-edit { background-color:#ffc107; color:#333; }
        .btn-delete { background-color:#dc3545; color:#fff; }
        .btn-detail { background-color:#007bff; color:#fff; }

        .btn-add:hover { background:#1976D2; }
        .btn-edit:hover { background:#e0a800; }
        .btn-delete:hover { background:#c82333; }
        .btn-detail:hover { background:#0056b3; }


        .table-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        .order-products {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .order-products li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            border-bottom: 1px solid #eee;
            padding: 6px 0;
            transition: background 0.2s;
        }

        .order-products li:last-child { border-bottom: none; }

        .order-products .product-name { flex: 1; font-weight: 500; color: #333; overflow: hidden; text-overflow: ellipsis; }
        .order-products .product-qty { color: #666; font-size: 13px; min-width: 60px; text-align: right; }
        .order-products .product-price { color: #007bff; font-weight: 500; min-width: 80px; text-align: right; }

        .delivery-info {
            background: #95aeeeff;
            border-radius: 6px;
            padding: 8px 10px;
            line-height: 1.5;
            font-size: 13px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .delivery-info div b { color:#222; min-width: 90px; display:inline-block; }

        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background: #fff;
            margin: 6% auto;
            padding: 25px;
            border-radius: 10px;
            max-width: 480px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .modal-content h3 { margin-top:0; color:#333; font-size:18px; font-weight:600; }
        .modal-content p { margin:6px 0; font-size:14px; }

        body.dark-mode-variables table { background-color: #1e1f24; color: #eaeaea; border-color:#444; }
        body.dark-mode-variables th { background-color:#2c2e35 !important; color:#fff !important; border-bottom:1px solid #444; }
        body.dark-mode-variables td { color:#e5e5e5 !important; border-bottom:1px solid #333; }
        
        </style>


        <table class="table-wrapper">
            <thead>
            <tr>
                <th>ID</th>
                <th>Người dùng</th>
                <th>Tên Khách hàng</th>
                <th>Địa chỉ</th>
                <th>SĐT</th>
                <th>Sản phẩm</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th>Giao hàng</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.id }}</td>
                <td>{{ order.user.username }}</td>
                <td>{{ order.customer_name }}</td>
                <td>{{ order.customer_address }}</td>
                <td>{{ order.customer_phone }}</td>

            <td>
            <style>
                .table-wrapper {
                    width: 100%;
                    overflow-x: auto;     
                }
                    
                .table-wrapper table {
                    min-width: 1200px;   
                }
                .order-products {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                }

                .order-products li {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    gap: 10px;
                    white-space: nowrap; 
                    border-bottom: 1px solid #eee;
                    padding: 6px 0;
                    transition: background 0.2s;
                }

                .order-products li:hover {
                    background: #f9f9f9ff;
                }

                .order-products li:last-child {
                    border-bottom: none;
                }

                .order-products .product-name {
                    flex: 1;
                    font-weight: 500;
                    color: #333;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                .order-products .product-qty {
                    color: #666;
                    font-size: 13px;
                    min-width: 60px;
                    text-align: right;
                }

                .order-products .product-price {
                    color: #007bff;
                    font-weight: 500;
                    min-width: 80px;
                    text-align: right;
                }
                
            </style>

            <ul class="order-products">
                {% for detail in order.order_details.all %}
                <li>
                    <span class="product-name">{{ detail.product.name }}</span>
                    <span class="product-qty">SL: {{ detail.quantity }}</span>
                </li>
                {% empty %}
                <li>Không có sản phẩm</li>
                {% endfor %}
            </ul>

            </td>


                <td>{{ order.total_price|intcomma }}đ</td>
                <td style="white-space: nowrap;">{{ order.get_status_display }}</td>

                <td>
                <div style="white-space: nowrap;" class="delivery-info">
                    <div ><b>Tình trạng:</b> {{ order.get_delivery_status_display }}</div>
                    {% if order.shipper_name %}
                    <div><b>Shipper:</b> {{ order.shipper_name }}</div>
                    <div><b>SĐT đặt hàng:</b> {{ order.shipper_phone }}</div>
                    {% endif %}
                    {% if order.delivery_start %}
                    <div><b>Bắt đầu:</b> {{ order.delivery_start|date:"d/m/Y H:i" }}</div>
                    {% endif %}
                    {% if order.delivery_end %}
                    <div><b>Hoàn tất:</b> {{ order.delivery_end|date:"d/m/Y H:i" }}</div>
                    {% endif %}
                </div>
                </td>
                <td style="display: flex; align-items: center; gap: 5px; flex-wrap: nowrap;">
<button class="btn-detail" onclick="showOrderDetail({{ order.id }}, '{{ order.customer_name }}', '{{ order.customer_phone }}', '{{ order.customer_address }}', '{{ order.get_status_display }}', '{{ order.created_at|date:'d/m/Y H:i' }}', '{{ order.shipper_name|default:'' }}', '{{ order.shipper_phone|default:'' }}', '{{ order.delivery_start|date:'d/m/Y H:i' }}', '{{ order.delivery_end|date:'d/m/Y H:i' }}')"> Xem </button>                    <button class="btn-edit" onclick="editOrder({{ order.id }});">Sửa</button>
                    <button class="btn-delete" onclick="deleteOrder({{ order.id }});">Xóa</button>
                </td>


            </tr>
            {% empty %}
            <tr><td colspan="10" style="text-align:center;">Không có đơn hàng nào</td></tr>
            {% endfor %}
        </tbody>
        </table>

        <div id="orderModal" class="modal">
            <div class="modal-content">
            <h3>Chi tiết đơn hàng</h3>
            <div id="orderDetailBody"></div>
            <button onclick="closeModal()" style="background:#6c757d; color:#fff; border:none; padding:8px 15px; border-radius:6px; cursor:pointer; margin-top:10px;">Đóng</button>
            </div>
        </div>

        <script>
            function showOrderDetail(id, customer, phone, address, status, created, shipper, shipperPhone, start, end) {
            const html = `
                <p><b>ID:</b> ${id}</p>
                <p><b>Khách hàng:</b> ${customer}</p>
                <p><b>Địa chỉ:</b> ${address}</p>
                <p><b>Trạng thái:</b> ${status}</p>
                <p><b>Ngày đặt:</b> ${created}</p>
                <hr>
                <p><b>Shipper:</b> ${shipper || 'Chưa có'}</p>
                <p><b>SĐT Shipper:</b> ${shipperPhone || 'Chưa có'}</p>
                <p><b>Bắt đầu  :</b> ${start || 'Chưa có'}</p>
                <p><b>Hoàn tất:</b> ${end || 'Chưa có'}</p>`;
            document.getElementById('orderDetailBody').innerHTML = html;
            document.getElementById('orderModal').style.display = 'block';
            }

            function closeModal() {
            document.getElementById('orderModal').style.display = 'none';
            }

            function editOrder(id) {
            window.location.href = `/dashboard/orders/edit/${id}/`;
            }

            function deleteOrder(id) {
                window.location.href = `/dashboard/orders/delete/${id}/`;
            }

            window.onclick = function (e) {
            const modal = document.getElementById('orderModal');
            if (e.target == modal) modal.style.display = 'none';
            }
        </script>
        </section>




        <section id="payments-section" class="custom-section">
            <h2>Thanh toán</h2>
            <table>
                <thead><tr><th>ID Đơn hàng</th><th>Phương thức</th><th>Trạng thái thanh toán</th><th>Tổng tiền</th></tr></thead>
                <tbody>
                    {% for payment in payments %}
                    <tr>
                        <td>{{ payment.order.id }}</td><td>{{ payment.payment_method }}</td><td>{{ payment.get_payment_status_display }}</td><td>{{ payment.amount|floatformat:0|intcomma }} VND</td>

                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Không tìm thấy thanh toán nào</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section id="revenues-section" class="custom-section">
            <h2>Doanh thu</h2>
        <style>
            .filter-form {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                gap: 10px;
                background: #f9fafb;
                padding: 12px 16px;
                border-radius: 10px;
                margin-bottom: 16px;
                box-shadow: 0 1px 4px rgba(0,0,0,0.08);
                font-family: "Poppins", sans-serif;
            }

            .filter-group {
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .filter-group label {
                font-weight: 500;
                color: #333;
            }

            .filter-group input {
                padding: 6px 8px;
                border: 1px solid #ccc;
                border-radius: 6px;
                font-size: 14px;
                transition: 0.2s;
            }

            .filter-group input:focus {
                border-color: #2196F3;
                outline: none;
                box-shadow: 0 0 4px rgba(33, 150, 243, 0.4);
            }

            .filter-actions {
                margin-left: auto;
                display: flex;
                gap: 8px;
            }

            .btn-filter,
            .btn-reset {
                padding: 8px 14px;
                border: none;
                border-radius: 6px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .btn-filter {
                background: #2196F3;
                color: white;
            }

            .btn-reset {
                background: #f1f1f1;
                color: #333;
            }

            .btn-filter:hover {
                background: #1976D2;
            }

            .btn-reset:hover {
                background: #e0e0e0;
            }
        </style>

        <form method="get" action="{% url 'dashboard_home' %}" class="filter-form">
            <input type="hidden" name="section" value="revenues-section">

            <div class="filter-group">
                <label>Ngày:</label>
                <input type="date" name="day" value="{{ request.GET.day }}">
            </div>

            <div class="filter-group">
                <label>Tháng:</label>
                <input type="number" name="month" min="1" max="12" value="{{ request.GET.month }}">
            </div>

            <div class="filter-group">
                <label>Năm:</label>
                <input type="number" name="year" min="2000" max="2100" value="{{ request.GET.year }}">
            </div>

            <div class="filter-group">
                <label>Sản phẩm:</label>

                <input type="text" name="product_name" list="product-list" placeholder="Nhập tên sản phẩm..." 
                    value="{{ request.GET.product_name }}" 
                    style="padding:6px; border-radius:6px; border:1px solid #ccc; margin-right:8px;">

                <datalist id="product-list">
                    {% for p in products %}
                        <option value="{{ p.name }}">
                    {% endfor %}
                </datalist>

                <select name="product_id" style="padding:6px; border-radius:6px; border:1px solid #ccc;">
                    <option value="">Tất cả sản phẩm</option>
                    {% for p in products %}
                        <option value="{{ p.id }}" {% if request.GET.product_id == p.id|stringformat:"s" %}selected{% endif %}>
                            {{ p.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>


            <div class="filter-actions">
                <button type="submit" class="btn-filter">Lọc</button>
                <button type="submit" name="reset" value="1" class="btn-reset">Reset</button>
            </div>
        </form>



            <table>
                <thead><tr><th>Ngày</th><th>Product</th><th>Số lượng</th><th>Tổng tiền</th></tr></thead>
                <tbody>
                    {% for rev in revenues %}
                    <tr>
                        <td>{{ rev.date|date:"Y-m-d" }}</td>
                        <td>{{ rev.product.name }}</td>
                        <td>{{ rev.quantity }}</td>
                        <td>{{ rev.total|intcomma }} VND</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Không tìm thấy danh thu nào</td></tr>
                    {% endfor %}
                </tbody>
            </table>

            <p><strong>Tổng doanh thu:</strong> {{ total_sales|intcomma }} VND</p>

            <canvas id="revenueChart" style="width:100%; max-height:400px; margin-top:20px;"></canvas>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
            const ctx = document.getElementById('revenueChart');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {{ chart_labels|safe }},
                    datasets: [{
                        label: 'Doanh thu (VND)',
                        data: {{ chart_values|safe }},
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: value => value.toLocaleString() } }
                    },
                    plugins: {
                        title: { display: true, text: 'Biểu đồ doanh thu' }
                    }
                }
            });
            </script>
        </section>


    </main>

    <div class="right-section">
        <div class="nav">
            <button id="menu-btn"><span class="material-icons-sharp">menu</span></button>
            <div class="dark-mode">
                <span class="material-icons-sharp active">light_mode</span>
                <span class="material-icons-sharp">dark_mode</span>
            </div>

        </div>
    </div>

</div>

<script>
    const sideMenu = document.querySelector('aside');
    document.getElementById('menu-btn').addEventListener('click', ()=>{ sideMenu.style.display='block'; });
    document.getElementById('close-btn').addEventListener('click', ()=>{ sideMenu.style.display='none'; });

    const darkMode = document.querySelector('.dark-mode');

    function updateDarkModeIcon() {
        if(document.body.classList.contains('dark-mode-variables')) {
            darkMode.querySelector('span:nth-child(1)').classList.remove('active');
            darkMode.querySelector('span:nth-child(2)').classList.add('active');    
        } else {
            darkMode.querySelector('span:nth-child(1)').classList.add('active');
            darkMode.querySelector('span:nth-child(2)').classList.remove('active');
        }
    }

    darkMode.addEventListener('click', ()=>{
        document.body.classList.toggle('dark-mode-variables');
        updateDarkModeIcon();

        if(document.body.classList.contains('dark-mode-variables')){
            localStorage.setItem('darkMode','true');
        } else {
            localStorage.setItem('darkMode','false');
        }
    });

    document.addEventListener('DOMContentLoaded', ()=>{
        if(localStorage.getItem('darkMode') === 'true'){
            document.body.classList.add('dark-mode-variables');
        } else {
            document.body.classList.remove('dark-mode-variables');
        }
        updateDarkModeIcon(); 
    });


 document.addEventListener('DOMContentLoaded', ()=>{

    const darkModeState = localStorage.getItem('darkMode');
    const darkMode = document.querySelector('.dark-mode');
    if(darkModeState === 'true'){
        document.body.classList.add('dark-mode-variables');
        darkMode.querySelector('span:nth-child(1)').classList.remove('active');
        darkMode.querySelector('span:nth-child(2)').classList.add('active');
    } else {
        document.body.classList.remove('dark-mode-variables');
        darkMode.querySelector('span:nth-child(1)').classList.add('active');
        darkMode.querySelector('span:nth-child(2)').classList.remove('active');
    }

    const sections = document.querySelectorAll('main section.custom-section');
    const dashboard = document.getElementById('dashboard-section');
    const links = document.querySelectorAll('aside .sidebar a[data-target]');

    const params = new URLSearchParams(window.location.search);
    const urlSection = params.get('section');
    let activeSection = urlSection || localStorage.getItem('activeSection') || 'dashboard-section';

    const target = document.getElementById(activeSection);
    if(target){
        sections.forEach(s => s.classList.remove('active'));
        target.classList.add('active');
        dashboard.style.display = activeSection === 'dashboard-section' ? 'block' : 'none';
    }

    links.forEach(l=>l.classList.remove('active'));
    const activeLink = Array.from(links).find(l=>l.dataset.target === activeSection);
    if(activeLink) activeLink.classList.add('active');

    const sectionSelect = document.querySelector('select#section-select');
    if(sectionSelect) sectionSelect.value = activeSection;

    links.forEach(link=>{
        link.addEventListener('click', e=>{
            e.preventDefault();
            const target = document.getElementById(link.dataset.target);
            if(target){
                sections.forEach(s=>s.classList.remove('active'));
                if(link.dataset.target !== 'dashboard-section'){ 
                    target.classList.add('active'); 
                    dashboard.style.display = 'none'; 
                } else {
                    dashboard.style.display = 'block';
                }

                links.forEach(l=>l.classList.remove('active'));
                link.classList.add('active');
                target.scrollIntoView({behavior:'smooth'});

                localStorage.setItem('activeSection', link.dataset.target);
                const url = new URL(window.location);
                url.searchParams.set('section', link.dataset.target);
                window.history.replaceState({}, '', url);

                if(sectionSelect) sectionSelect.value = link.dataset.target;
            }
        });
    });
});


</script>
</body>
</html>
